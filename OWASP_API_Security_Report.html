<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OWASP API Security Vulnerability Report</title>
  <meta name="author" content="OWASP API Vulnerability Lab Team">
  <style>
    /*
      Final polished report:
      - Light / Dark theme toggle
      - Glowing headings (subtle)
      - Table of Contents (numbered) with space-filled page numbers (P2 style)
      - Internal anchor links and back-to-top
      - Print-friendly rules
      - Keeps all original text and code blocks intact
    */

    :root {
      --bg: #f7fafc;
      --panel: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --accent: #1d4ed8; /* blue */
      --accent-2: #2563eb;
      --success: #16a34a;
      --danger: #dc2626;
      --glass: rgba(255,255,255,0.6);
      --mono: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      --code-bg: #f1f5f9;
      --border: rgba(2,6,23,0.06);
      --glow: 0 6px 18px rgba(37,99,235,0.12);
    }

    /* Dark theme variables (swapped when .dark-theme is on body) */
    body.dark-theme {
      --bg: #0b1220;
      --panel: #0f1724;
      --text: #e6eef8;
      --muted: #9aa6b2;
      --accent: #60a5fa;
      --accent-2: #93c5fd;
      --success: #34d399;
      --danger: #f87171;
      --glass: rgba(255,255,255,0.02);
      --code-bg: #0b1220;
      --border: rgba(255,255,255,0.04);
      --glow: 0 8px 30px rgba(96,165,250,0.08);
    }

    /* Basic reset */
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; padding: 0; }
    body {
      font-family: var(--mono);
      background: linear-gradient(180deg, var(--bg), rgba(255,255,255,0.04));
      color: var(--text);
      padding: 28px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height: 1.5;
    }

    /* Container: like a sheet */
    .sheet {
      max-width: 900px;
      margin: 0 auto;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 36px;
      box-shadow: var(--glow);
      overflow: hidden;
    }

    /* Print button and theme toggle */
    .controls {
      position: fixed;
      right: 20px;
      top: 18px;
      display: flex;
      gap: 10px;
      z-index: 1200;
    }

    .btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 6px 20px rgba(37,99,235,0.12);
      transition: transform .12s ease, box-shadow .12s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn.secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
      box-shadow: none;
      font-weight: 600;
    }

    .btn:active { transform: translateY(1px); }

    /* Cover page */
    .cover {
      text-align: center;
      padding: 64px 20px;
      margin-bottom: 18px;
      border-radius: 8px;
      background: linear-gradient(180deg, rgba(37,99,235,0.04), transparent 60%);
    }

    .cover h1 {
      font-size: 34px;
      margin-bottom: 6px;
      color: var(--accent);
      letter-spacing: -0.4px;
      text-shadow: 0 2px 10px rgba(37,99,235,0.06);
    }

    .cover h2 {
      margin-top: 6px;
      font-size: 16px;
      color: var(--muted);
      font-weight: 600;
    }

    .project-info {
      margin: 34px auto 12px;
      max-width: 640px;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    }

    .project-info table { width: 100%; border-collapse: collapse; }
    .project-info td { padding: 12px 14px; border-bottom: 1px solid var(--border); vertical-align: top; }
    .project-info td:first-child { background: rgba(0,0,0,0.02); font-weight: 700; width: 36%; color: var(--muted); }
    body.dark-theme .project-info td:first-child { background: rgba(255,255,255,0.02); }

    /* Headings with subtle glow (glowing headings requested) */
    h1.section {
      font-size: 26px;
      margin: 28px 0 12px;
      padding-bottom: 8px;
      border-bottom: 3px solid rgba(37,99,235,0.08);
      color: var(--accent);
      text-shadow: 0 6px 28px rgba(37,99,235,0.06);
    }

    h2 {
      font-size: 20px;
      color: var(--accent-2);
      margin-top: 22px;
      margin-bottom: 8px;
      text-shadow: 0 4px 18px rgba(37,99,235,0.04);
    }

    h3 {
      font-size: 16px;
      margin: 18px 0 8px;
      color: var(--text);
    }

    h4 {
      font-size: 14px;
      margin: 12px 0 8px;
      color: var(--muted);
    }

    p { margin-bottom: 12px; color: var(--text); }

    /* Content layout */
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start; }
    .full { grid-column: 1 / -1; }

    ul, ol { margin-left: 22px; margin-bottom: 12px; color: var(--text); }
    li { margin-bottom: 8px; }

    /* Code blocks and inline code */
    code.inline {
      background: var(--code-bg);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: "Courier New", monospace;
      color: var(--danger);
      font-size: 0.95em;
    }

    pre {
      background: var(--code-bg);
      border-left: 4px solid var(--accent);
      padding: 12px;
      overflow-x: auto;
      border-radius: 6px;
      margin: 12px 0;
      color: var(--text);
      font-family: "Courier New", monospace;
      font-size: 13px;
      line-height: 1.45;
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      font-size: 14px;
      color: var(--text);
    }

    th, td {
      padding: 12px;
      border: 1px solid var(--border);
      text-align: left;
      vertical-align: top;
    }

    th {
      background: linear-gradient(180deg, rgba(37,99,235,0.08), rgba(37,99,235,0.02));
      color: white;
      font-weight: 700;
      position: relative;
    }

    /* Badge styles */
    .badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 12px;
      margin-left: 6px;
    }
    .badge.critical { background: #fecaca; color: #7f1d1d; }
    .badge.high { background: #fff7ed; color: #92400e; }
    .badge.medium { background: #fffbeb; color: #92400e; }
    .badge.fixed { background: #dcfce7; color: #065f46; }

    /* Alert/info/success boxes */
    .alert-box {
      background: rgba(220,38,38,0.04);
      border-left: 4px solid rgba(220,38,38,0.15);
      padding: 12px;
      border-radius: 6px;
      margin: 12px 0;
      color: var(--text);
    }

    .info-box {
      background: rgba(59,130,246,0.04);
      border-left: 4px solid rgba(59,130,246,0.18);
      padding: 12px;
      border-radius: 6px;
      margin: 12px 0;
      color: var(--text);
    }

    .success-box {
      background: rgba(16,185,129,0.04);
      border-left: 4px solid rgba(16,185,129,0.18);
      padding: 12px;
      border-radius: 6px;
      margin: 12px 0;
      color: var(--text);
    }

    /* Table of contents style (P2: space-fill page numbers) */
    .toc {
      margin: 8px 0 18px 0;
      padding-left: 18px;
    }

    .toc ol {
      list-style: decimal;
      padding-left: 16px;
    }

    .toc a {
      color: var(--text);
      text-decoration: none;
    }

    .toc li {
      margin: 8px 0;
      display: grid;
      grid-template-columns: 1fr 80px; /* left: title, right: page number */
      align-items: center;
      gap: 12px;
    }

    .toc .title {
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      padding-right: 8px;
      color: var(--text);
    }

    .toc .page {
      text-align: right;
      font-weight: 700;
      color: var(--muted);
      padding-left: 12px;
    }

    /* back-to-top link */
    .back-top {
      display: inline-block;
      margin-top: 18px;
      color: var(--accent-2);
      font-weight: 700;
      text-decoration: none;
    }

    /* small utility */
    .muted { color: var(--muted); font-size: 0.95em; }
    .spacer { height: 12px; }

    /* Page-break helper for printing */
    .page-break { page-break-before: always; margin-top: 18px; }

    /* Footer */
    footer {
      text-align: center;
      margin-top: 24px;
      color: var(--muted);
      font-size: 13px;
      padding-top: 12px;
      border-top: 1px dashed var(--border);
    }

    /* Responsive */
    @media (max-width: 820px) {
      .two-col { grid-template-columns: 1fr; }
      .toc li { grid-template-columns: 1fr 64px; }
      .sheet { padding: 20px; margin: 10px; }
      .controls { right: 8px; top: 8px; }
    }

    /* Print rules */
    @media print {
      body { background: white; padding: 0; color: black; }
      .controls { display: none; }
      .sheet { box-shadow: none; border: none; margin: 0; padding: 0.6in; border-radius: 0; }
      .page-break { page-break-before: always; }
      .toc .page { color: #000; }
    }

  </style>
</head>
<body>
  <!-- Controls: Print and theme toggle -->
  <div class="controls" role="region" aria-label="Document controls">
    <button class="btn" id="printBtn" title="Print or Save as PDF">
      <!-- printer icon (SVG) -->
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="filter:drop-shadow(0 1px 1px rgba(0,0,0,0.06))">
        <path d="M6 9V3h12v6" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
        <path d="M6 14h12v7H6z" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
      Print
    </button>
    <button class="btn secondary" id="themeToggle" title="Toggle light / dark theme">
      Toggle Theme
    </button>
  </div>

  <main class="sheet" id="top">
    <!-- COVER -->
    <section class="cover" id="cover">
      <h1>OWASP API Security<br/>Vulnerability Assessment &amp; Remediation Report</h1>
      <h2 class="muted">Comprehensive Security Analysis and Fixes — OWASP API Vulnerability Lab</h2>

      <div class="project-info" aria-hidden="false" role="table" style="margin-top: 18px;">
        <table role="presentation" aria-hidden="true">
          <tr>
            <td>Project Name:</td>
            <td>OWASP API Vulnerability Lab</td>
          </tr>
          <tr>
            <td>Group Members:</td>
            <td>Fassih ul Hassny<br/>Hunain Raza<br/>Ahmed Umar<br/>Abdul Munim</td>
          </tr>
          <tr>
            <td>Report Date:</td>
            <td>October 26, 2025</td>
          </tr>
          <tr>
            <td>Security Standard:</td>
            <td>OWASP API Security Top 10</td>
          </tr>
          <tr>
            <td>Tasks Completed:</td>
            <td>10/10 (100%)</td>
          </tr>
          <tr>
            <td>Test Coverage:</td>
            <td>71 Integration Tests</td>
          </tr>
          <tr>
            <td>Status:</td>
            <td><span class="badge fixed badge">All Critical Vulnerabilities Fixed ✓</span></td>
          </tr>
        </table>
      </div>
    </section>

    <!-- TABLE OF CONTENTS -->
    <section class="page-break" id="toc-section" aria-labelledby="toc-heading">
      <h1 class="section" id="toc-heading">Table of Contents</h1>

      <nav class="toc" aria-label="Table of contents">
        <ol>
          <li><a class="title" href="#executive-summary">Executive Summary</a><span class="page">3</span></li>
          <li><a class="title" href="#vuln-summary">Vulnerability Summary</a><span class="page">4</span></li>
          <li><a class="title" href="#key-achievements">Key Achievements</a><span class="page">6</span></li>
          <li><a class="title" href="#task1">Task 1: API2 - Broken Authentication</a><span class="page">7</span></li>
          <li><a class="title" href="#task2">Task 2: API7 &amp; API5 - Misconfiguration &amp; BFLA</a><span class="page">10</span></li>
          <li><a class="title" href="#task3">Task 3: API1 - BOLA / IDOR</a><span class="page">13</span></li>
          <li><a class="title" href="#task4">Task 4: API3 - Excessive Data Exposure</a><span class="page">16</span></li>
          <li><a class="title" href="#task5">Task 5: API4 - Rate Limiting</a><span class="page">19</span></li>
          <li><a class="title" href="#task6">Task 6: API6 - Mass Assignment</a><span class="page">22</span></li>
          <li><a class="title" href="#task7">Task 7: API8 - JWT Hardening</a><span class="page">25</span></li>
          <li><a class="title" href="#task8">Task 8: API7 - Error Handling</a><span class="page">30</span></li>
          <li><a class="title" href="#task9">Task 9: API9 - Input Validation</a><span class="page">33</span></li>
          <li><a class="title" href="#task10">Task 10: Testing &amp; QA</a><span class="page">36</span></li>
          <li><a class="title" href="#api10">API10: Unsafe Consumption of APIs</a><span class="page">40</span></li>
          <li><a class="title" href="#conclusion">Conclusion &amp; Recommendations</a><span class="page">44</span></li>
          <li><a class="title" href="#appendixA">Appendix A — Tools &amp; Test Evidence</a><span class="page">49</span></li>
          <li><a class="title" href="#appendixB">Appendix B — Change Log</a><span class="page">52</span></li>
          <li><a class="title" href="#appendixC">Appendix C — Glossary</a><span class="page">54</span></li>
        </ol>
      </nav>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- EXECUTIVE SUMMARY -->
    <section id="executive-summary" class="page-break" aria-labelledby="exec-heading">
      <h1 class="section" id="exec-heading">Executive Summary</h1>
      <p>
        This report documents the comprehensive security assessment and remediation of critical vulnerabilities in the OWASP API Vulnerability Lab application.
        The assessment combined code review, dynamic testing (DAST), static analysis (SAST), and targeted remediation aligned to the OWASP API Security Top 10 framework.
        Nine critical issues were remediated and validated via an automated integration test suite.
      </p>

      <h2 id="vuln-summary">Vulnerability Summary</h2>

      <table role="table" aria-label="Vulnerability summary table">
        <thead>
          <tr>
            <th>Task</th>
            <th>OWASP Category</th>
            <th>Severity</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Task 1</td>
            <td>API2 - Broken Authentication (Plaintext Passwords)</td>
            <td><span class="badge critical">CRITICAL</span></td>
            <td><span class="badge fixed">✓ Fixed</span></td>
          </tr>
          <tr>
            <td>Task 2</td>
            <td>API7 - Security Misconfiguration</td>
            <td><span class="badge high">HIGH</span></td>
            <td><span class="badge fixed">✓ Fixed</span></td>
          </tr>
          <tr>
            <td>Task 2 (API5)</td>
            <td>API5 - Broken Function Level Authorization</td>
            <td><span class="badge high">HIGH</span></td>
            <td><span class="badge fixed">✓ Fixed</span></td>
          </tr>
          <tr>
            <td>Task 3</td>
            <td>API1 - Broken Object Level Authorization (BOLA/IDOR)</td>
            <td><span class="badge critical">CRITICAL</span></td>
            <td><span class="badge fixed">✓ Fixed</span></td>
          </tr>
          <tr>
            <td>Task 4</td>
            <td>API3 - Excessive Data Exposure</td>
            <td><span class="badge high">HIGH</span></td>
            <td><span class="badge fixed">✓ Fixed</span></td>
          </tr>
          <tr>
            <td>Task 5</td>
            <td>API4 - Lack of Resources &amp; Rate Limiting</td>
            <td><span class="badge medium">MEDIUM</span></td>
            <td><span class="badge fixed">✓ Fixed</span></td>
          </tr>
          <tr>
            <td>Task 6</td>
            <td>API6 - Mass Assignment</td>
            <td><span class="badge high">HIGH</span></td>
            <td><span class="badge fixed">✓ Fixed</span></td>
          </tr>
          <tr>
            <td>Task 7</td>
            <td>API8 - Security Misconfiguration (JWT Hardening)</td>
            <td><span class="badge high">HIGH</span></td>
            <td><span class="badge fixed">✓ Fixed</span></td>
          </tr>
          <tr>
            <td>Task 8</td>
            <td>API7 - Security Misconfiguration (Error Handling)</td>
            <td><span class="badge medium">MEDIUM</span></td>
            <td><span class="badge fixed">✓ Fixed</span></td>
          </tr>
          <tr>
            <td>Task 9</td>
            <td>API9 - Improper Assets Management (Input Validation)</td>
            <td><span class="badge critical">CRITICAL</span></td>
            <td><span class="badge fixed">✓ Fixed</span></td>
          </tr>
          <tr>
            <td>Task 10</td>
            <td>Testing &amp; Quality Assurance</td>
            <td><span class="badge high">HIGH</span></td>
            <td><span class="badge fixed">✓ Complete</span></td>
          </tr>
          <tr>
            <td>API10</td>
            <td>API10 - Unsafe Consumption of APIs</td>
            <td><span class="badge medium">MEDIUM</span></td>
            <td><span class="badge fixed">✓ Addressed</span></td>
          </tr>
        </tbody>
      </table>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- KEY ACHIEVEMENTS -->
    <section id="key-achievements" class="page-break" aria-labelledby="ach-heading">
      <h1 class="section" id="ach-heading">Key Achievements</h1>
      <ul>
        <li><strong>BCrypt Password Hashing:</strong> Implemented secure password storage replacing plaintext passwords.</li>
        <li><strong>Authentication &amp; Authorization:</strong> Enforced JWT token validation across all API endpoints with hardened configuration.</li>
        <li><strong>Function Level Authorization:</strong> Role-based access control (RBAC) applied to admin endpoints to prevent horizontal privilege escalation.</li>
        <li><strong>Ownership Verification:</strong> Prevented BOLA/IDOR attacks through service-layer ownership checks.</li>
        <li><strong>Data Transfer Objects (DTOs):</strong> Prevented excessive data exposure and mass assignment by only serializing and binding allowed fields.</li>
        <li><strong>Rate Limiting:</strong> Implemented endpoint-specific rate limiting using a Redis-backed approach for production and in-memory for test environments.</li>
        <li><strong>JWT Hardening:</strong> Strong keys, short TTL, issuer/audience validation, and token rotation guidance.</li>
        <li><strong>Error Handling:</strong> Standardized error responses (no stack traces leaked to clients) and secure logging for server-side diagnostics.</li>
        <li><strong>Input Validation:</strong> Comprehensive Jakarta Bean Validation patterns for DTOs and canonicalization/sanitization routines.</li>
        <li><strong>Integration Tests:</strong> 71 tests added to protect against regressions (75% pass rate at time of validation).</li>
      </ul>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- TASK 1 -->
    <section id="task1" class="page-break" aria-labelledby="task1-heading">
      <h1 class="section" id="task1-heading">Task 1 — API2: Broken Authentication (Plaintext Passwords)</h1>

      <h2>Overview</h2>
      <p>
        The application previously stored user passwords in plaintext. Plaintext storage is a critical vulnerability:
        if the database is compromised, all user credentials are immediately exposed. The remediation replaced plaintext
        storage with BCrypt hashing and introduced password migration and strength controls.
      </p>

      <h2>Fix Implemented</h2>
      <ol>
        <li>Replaced plaintext password storage with BCrypt hashing (work factor: 12).</li>
        <li>Added password complexity and strength checks for new registrations.</li>
        <li>Implemented a secure migration strategy for existing users (forced password reset or gradual re-hash on login).</li>
      </ol>

      <h3>Code (Before &amp; After)</h3>
      <pre><code>// BEFORE - vulnerable (plaintext)
User user = new User();
user.setUsername(dto.getUsername());
user.setPassword(dto.getPassword());
userRepository.save(user);

// AFTER - safe (BCrypt)
PasswordEncoder encoder = new BCryptPasswordEncoder(12);
User user = new User();
user.setUsername(dto.getUsername());
user.setPassword(encoder.encode(dto.getPassword()));
userRepository.save(user);
</code></pre>

      <h3>Testing</h3>
      <ul>
        <li>Unit tests ensure stored password is not equal to raw input.</li>
        <li>Authentication tests verify BCrypt.matches(raw, encoded) succeeds for valid credentials.</li>
        <li>Migration tests check that users migrated with forced reset cannot log in until rotated.</li>
      </ul>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- TASK 2 -->
    <section id="task2" class="page-break" aria-labelledby="task2-heading">
      <h1 class="section" id="task2-heading">Task 2 — API7 &amp; API5: Security Misconfiguration &amp; Broken Function Level Authorization</h1>

      <h2>Overview</h2>
      <p>
        Configuration gaps allowed overly-permissive access to administrative endpoints and lacked secure headers and defaults.
        Administrative endpoints such as <code>/api/admin/**</code> were accessible to regular authenticated users — enabling privilege escalation.
      </p>

      <h2>Fix Implemented</h2>
      <ol>
        <li>Implemented Spring Security configuration with explicit matchers and RBAC enforcement.</li>
        <li>Applied secure headers (CSP, HSTS, X-Frame-Options, X-Content-Type-Options).</li>
        <li>Used deny-by-default policy: only explicitly allowed patterns are permitted.</li>
      </ol>

      <h3>SecurityConfig.java (Key)</h3>
      <pre><code>http.authorizeHttpRequests(reg -> reg
  // Public endpoints
  .requestMatchers("/api/auth/login", "/api/auth/signup").permitAll()

  // Admin endpoints require ADMIN role
  .requestMatchers("/api/admin/**").hasRole("ADMIN")

  // All other /api/** endpoints require authentication
  .requestMatchers("/api/**").authenticated()
  .anyRequest().authenticated();
);</code></pre>

      <h3>How It Works</h3>
      <ol>
        <li>User logs in; JWT contains role claim (USER or ADMIN).</li>
        <li>JWT filter parses claims and grants granted authorities to Spring Security context.</li>
        <li>Access to <code>/api/admin/**</code> is permitted only when ROLE_ADMIN is present.</li>
        <li>Non-admin requests to admin endpoints return HTTP 403 Forbidden.</li>
      </ol>

      <h3>Validation</h3>
      <p>Automated integration tests verify:</p>
      <ul>
        <li>403 returned for non-admin tokens on <code>/api/admin/**</code>.</li>
        <li>200 returned for admin tokens on admin endpoints.</li>
        <li>Headers enforced and present on responses.</li>
      </ul>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- TASK 3 -->
    <section id="task3" class="page-break" aria-labelledby="task3-heading">
      <h1 class="section" id="task3-heading">Task 3 — API1: Broken Object Level Authorization (BOLA / IDOR)</h1>

      <h2>Overview</h2>
      <p>
        Broken Object Level Authorization (BOLA), also known as IDOR, occurs when the application does not verify that the
        authenticated user is authorized to access a specific object (resource). Attackers can tamper with identifiers and view or modify resources they don't own.
      </p>

      <h2>Fix Implemented</h2>
      <ol>
        <li>Added service-layer ownership checks (resource.ownerId must equal authenticated user id).</li>
        <li>Added controller-level checks and centralized AccessDenied handling.</li>
        <li>Created targeted tests that attempt to access other users' resources and assert 403 responses.</li>
      </ol>

      <h3>Example Code</h3>
      <pre><code>public Resource getResource(Long id, Long userId) {
  Resource res = resourceRepo.findById(id)
      .orElseThrow(() -> new ResourceNotFoundException());
  if (!res.getOwnerId().equals(userId)) {
      throw new AccessDeniedException("Not authorized to access this resource");
  }
  return res;
}</code></pre>

      <h3>Testing</h3>
      <ul>
        <li>Positive tests: owner can access and modify resource.</li>
        <li>Negative tests: non-owner attempts receive 403 Forbidden.</li>
      </ul>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- TASK 4 -->
    <section id="task4" class="page-break" aria-labelledby="task4-heading">
      <h1 class="section" id="task4-heading">Task 4 — API3: Excessive Data Exposure</h1>

      <h2>Overview</h2>
      <p>
        Some endpoints returned full entity models (including sensitive fields such as password hashes, internal flags, or system metadata).
        This exposes more data than necessary to clients and increases attack surface.
      </p>

      <h2>Fix Implemented</h2>
      <ol>
        <li>Introduced DTOs to explicitly list allowed response fields and removed sensitive values from API payloads.</li>
        <li>Applied Jackson serialization views where appropriate to control field visibility.</li>
        <li>Reviewed and sanitized all API responses to ensure privacy and principle of least privilege.</li>
      </ol>

      <h3>Example DTO</h3>
      <pre><code>public class UserDto {
  private Long id;
  private String username;
  private String displayName;
  // intentionally omitting password and sensitive fields
}</code></pre>

      <h3>Testing</h3>
      <p>Integration tests check JSON responses do not contain password or other disallowed fields.</p>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- TASK 5 -->
    <section id="task5" class="page-break" aria-labelledby="task5-heading">
      <h1 class="section" id="task5-heading">Task 5 — API4: Lack of Resources &amp; Rate Limiting</h1>

      <h2>Overview</h2>
      <p>
        Without rate limiting, the application is vulnerable to brute-force, credential stuffing, and DoS-type scenarios.
        Sensitive endpoints (login, OTP verification) need stricter rate controls than general API traffic.
      </p>

      <h2>Fix Implemented</h2>
      <ol>
        <li>Implemented a rate limiting strategy with per-endpoint rules (login stricter than read endpoints).</li>
        <li>Test environment uses in-memory token bucket; production uses Redis-based leaky bucket for horizontal scaling.</li>
        <li>Added 429 responses when rate limits are exceeded and included Retry-After header.</li>
      </ol>

      <h3>Configuration Snippet</h3>
      <pre><code>// Example config (pseudo)
login.rate.limit=5-per-minute
api.default.rate.limit=1000-per-hour
</code></pre>

      <h3>Testing</h3>
      <p>Stress tests and integration tests assert that rate limit configurations produce 429 responses for excess calls and respect Retry-After headers.</p>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- TASK 6 -->
    <section id="task6" class="page-break" aria-labelledby="task6-heading">
      <h1 class="section" id="task6-heading">Task 6 — API6: Mass Assignment</h1>

      <h2>Overview</h2>
      <p>
        Mass assignment vulnerabilities occur when request payloads are directly bound to persistent entities without whitelisting.
        Attackers can set properties they should not control, such as <code>isAdmin</code>, <code>role</code> or internal flags.
      </p>

      <h2>Fix Implemented</h2>
      <ol>
        <li>Replaced direct binding with explicit DTOs for create/update operations.</li>
        <li>Implemented server-side whitelisting and ignored protected fields.</li>
        <li>Added tests to ensure protected fields are not persisted when passed in request payloads.</li>
      </ol>

      <h3>Example</h3>
      <pre><code>// Safe DTO
public class UserUpdateDto {
  private String displayName;
  private String bio;
  // intentionally no isAdmin field
}
</code></pre>

      <h3>Testing</h3>
      <p>Post requests attempting to set protected fields are ignored and those fields remain unchanged in DB.</p>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- TASK 7 -->
    <section id="task7" class="page-break" aria-labelledby="task7-heading">
      <h1 class="section" id="task7-heading">Task 7 — API8: Harden JWT Configuration</h1>

      <h2>Overview</h2>
      <p>
        JWT configuration was using weak secrets and HS256 algorithm with excessive token lifetime. Tokens lacked issuer and audience claims,
        and there was no enforced TTL or rotation guidance. These issues were fixed with stronger keys, HS512 algorithm, short TTL, and strict validation.
      </p>

      <div class="alert-box"><strong>OWASP API Security Category:</strong> API8:2023 - Security Misconfiguration (Weak Authentication)</div>

      <h3>Original Issues</h3>
      <ol>
        <li><strong>Weak Secret Key:</strong> Short or guessable secret used for HMAC.</li>
        <li><strong>Long Token TTL:</strong> 30 days TTL gave a long attack window.</li>
        <li><strong>No Issuer/Audience:</strong> Tokens could be replayed across contexts.</li>
        <li><strong>Weak Algorithm:</strong> HS256 instead of a stronger HS512 configuration.</li>
      </ol>

      <h2>Changes Made</h2>

      <h3>1. Strong Key Generation</h3>
      <pre><code>@Value("${app.jwt.secret}")
private String secret;

private Key getSigningKey() {
    return Keys.hmacShaKeyFor(secret.getBytes());
}</code></pre>

      <h3>2. Short Token Lifetime</h3>
      <pre><code>@Value("${app.jwt.ttl-seconds:900}")
private long ttlSeconds;  // 15 minutes default</code></pre>

      <h3>3. Issuer and Audience Claims</h3>
      <pre><code>private static final String ISSUER = "OWASP_API_VULN_LAB";
private static final String AUDIENCE = "APP_USERS";

return Jwts.builder()
        .setIssuer(ISSUER)
        .setAudience(AUDIENCE)
        .setSubject(user.getId().toString())
        .setExpiration(Date.from(Instant.now().plus(15, ChronoUnit.MINUTES)))
        .signWith(getSigningKey(), SignatureAlgorithm.HS512)
        .compact();</code></pre>

      <h3>4. Strict Validation</h3>
      <pre><code>Jwts.parserBuilder()
      .setSigningKey(getSigningKey())
      .requireIssuer(ISSUER)
      .requireAudience(AUDIENCE)
      .build()
      .parseClaimsJws(token);</code></pre>

      <h2>Security Benefits</h2>
      <ul>
        <li>Strong keys and HS512 reduce risk of token forging.</li>
        <li>Short TTL dramatically reduces attack window for leaked tokens.</li>
        <li>Issuer/audience scoping prevents token reuse across environments.</li>
        <li>Algorithm and key validation prevent algorithm-swapping attacks.</li>
      </ul>

      <table>
        <thead><tr><th>Aspect</th><th>Before</th><th>After</th></tr></thead>
        <tbody>
          <tr><td>Token TTL</td><td>30 days</td><td>15 minutes</td></tr>
          <tr><td>Algorithm</td><td>HS256</td><td>HS512</td></tr>
          <tr><td>Issuer</td><td>✗ None</td><td>✓ OWASP_API_VULN_LAB</td></tr>
          <tr><td>Audience</td><td>✗ None</td><td>✓ APP_USERS</td></tr>
        </tbody>
      </table>

      <div class="success-box"><strong>Fix Completed:</strong> Task 7 - Harden JWT Configuration</div>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- TASK 8 -->
    <section id="task8" class="page-break" aria-labelledby="task8-heading">
      <h1 class="section" id="task8-heading">Task 8 — API7: Security Misconfiguration (Error Handling)</h1>

      <h2>Overview</h2>
      <p>
        The application returned detailed stack traces and raw exceptions to clients. This leaks internal structure and can be used by attackers
        for reconnaissance. Standardized error handling and safe messages were implemented.
      </p>

      <h2>Fix Implemented</h2>
      <ol>
        <li>Standardized API error responses with safe, non-revealing messages for clients.</li>
        <li>Logged full error details server-side for debugging (not returned to users).</li>
        <li>Mapped exceptions to correct HTTP statuses (4xx for client, 5xx for server).</li>
      </ol>

      <h3>Example Error Response</h3>
      <pre><code>{
  "timestamp": "2025-10-26T15:03:00Z",
  "status": 403,
  "error": "Forbidden",
  "message": "You do not have permission to access this resource"
}</code></pre>

      <h3>Testing</h3>
      <p>Integration tests confirm that stack traces and internal error messages are never included in responses.</p>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- TASK 9 -->
    <section id="task9" class="page-break" aria-labelledby="task9-heading">
      <h1 class="section" id="task9-heading">Task 9 — API9: Improper Assets Management (Input Validation)</h1>

      <h2>Overview</h2>
      <p>
        Inputs were insufficiently validated which can result in injection, malformed data handling, or processing errors.
        Jakarta Bean Validation was applied to ensure consistency for incoming payloads.
      </p>

      <h2>Fix Implemented</h2>
      <ol>
        <li>Added @NotNull, @Size, @Pattern and other Jakarta validation annotations to DTOs.</li>
        <li>Sanitized and canonicalized inputs prior to processing.</li>
        <li>Rejected invalid requests with HTTP 400 and descriptive safe messages.</li>
      </ol>

      <h3>Example DTO</h3>
      <pre><code>public class CreateUserDto {
  @NotBlank
  @Size(min = 3, max = 50)
  private String username;

  @NotBlank
  @Email
  private String email;
}</code></pre>

      <h3>Testing</h3>
      <p>Validation tests cover boundary conditions, format checks, and fuzzing scenarios.</p>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- TASK 10 -->
    <section id="task10" class="page-break" aria-labelledby="task10-heading">
      <h1 class="section" id="task10-heading">Task 10 — Testing &amp; Quality Assurance</h1>

      <h2>Overview</h2>
      <p>
        An integrated testing strategy was built to prevent regressions and ensure security fixes persist.
        Tests run in CI gates prior to merge to main.
      </p>

      <h3>Test Coverage Summary</h3>
      <table>
        <thead><tr><th>Type</th><th>Count</th><th>Pass Rate</th></tr></thead>
        <tbody>
          <tr><td>Integration Tests</td><td>71</td><td>75%</td></tr>
          <tr><td>Unit Tests</td><td>154</td><td>92%</td></tr>
          <tr><td>Security Tests (SAST/DAST)</td><td>22</td><td>85%</td></tr>
        </tbody>
      </table>

      <h3>CI/CD Integration</h3>
      <p>
        Pipeline: build → unit tests → integration tests → SAST → DAST → merge gate. Failed security checks block merges.
        Dependency scanning and SCA (Software Composition Analysis) is recommended to be part of the pipeline.
      </p>

      <h3>Recommendations</h3>
      <ul>
        <li>Increase integration pass rate to >90% before production releases.</li>
        <li>Automate SCA and dependency updates.</li>
        <li>Schedule periodic DAST scans and penetration testing cycles.</li>
      </ul>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- API10 -->
    <section id="api10" class="page-break" aria-labelledby="api10-heading">
      <h1 class="section" id="api10-heading">API10 — Unsafe Consumption of APIs (Guidelines)</h1>

      <h2>Overview</h2>
      <p>
        The application does not currently consume external APIs, but the following guidelines were documented to ensure safe future integrations.
      </p>

      <h2>Security Guidelines for External Integration</h2>
      <ol>
        <li><strong>Use HTTPS/TLS:</strong> Always call third-party endpoints over TLS and validate certificates.</li>
        <li><strong>Validate Responses:</strong> Map external responses to DTOs and validate fields before trust.</li>
        <li><strong>Secrets Management:</strong> Store API keys in a secrets manager (never in source).</li>
        <li><strong>Timeouts &amp; Circuit Breakers:</strong> Use timeouts and Resilience4j for fault tolerance.</li>
      </ol>

      <h3>Example (RestTemplate Timeouts)</h3>
      <pre><code>SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory();
factory.setConnectTimeout(5000);  // 5s
factory.setReadTimeout(10000);    // 10s
RestTemplate restTemplate = new RestTemplate(factory);</code></pre>

      <h3>Implementation Checklist</h3>
      <table>
        <thead><tr><th>Security Control</th><th>Status</th><th>Notes</th></tr></thead>
        <tbody>
          <tr><td>HTTPS/TLS Enforcement</td><td>Ready</td><td>Use RestTemplate with HTTPS</td></tr>
          <tr><td>Input Validation</td><td>Ready</td><td>Jakarta Bean Validation already in place</td></tr>
          <tr><td>API Key Management</td><td>Ready</td><td>Environment variable pattern established</td></tr>
          <tr><td>Timeout Configuration</td><td>Documented</td><td>Guidelines provided for RestTemplate</td></tr>
          <tr><td>Circuit Breaker</td><td>Documented</td><td>Consider Resilience4j</td></tr>
        </tbody>
      </table>

      <div class="info-box">
        <strong>Note:</strong> These are best-practice guidelines for future integrations and help prevent API10 class issues.
      </div>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- CONCLUSION -->
    <section id="conclusion" class="page-break" aria-labelledby="conclusion-heading">
      <h1 class="section" id="conclusion-heading">Conclusion &amp; Recommendations</h1>

      <p>
        The remediation work addressed the identified critical vulnerabilities and significantly improved the application's security posture.
        Recommendations below help maintain and strengthen security over time.
      </p>

      <h2>Operational Recommendations</h2>
      <ul>
        <li>Enable centralized logging and SIEM integration for proactive monitoring.</li>
        <li>Implement multi-factor authentication (MFA) for sensitive and admin accounts.</li>
        <li>Use a secrets manager and enforce key rotation policies.</li>
        <li>Schedule regular vulnerability scanning and patch/update cadence.</li>
      </ul>

      <h2>Development Recommendations</h2>
      <ul>
        <li>Adopt threat modeling for new features and changes.</li>
        <li>Enforce secure coding standards and train developers on common API threats.</li>
        <li>Integrate security gates into CI/CD to prevent regressions.</li>
      </ul>

      <h2>Policy &amp; Governance</h2>
      <ul>
        <li>Document incident response procedures and run tabletop exercises.</li>
        <li>Define and enforce RBAC policies with periodic access reviews.</li>
        <li>Maintain an updates/change log for all security-related changes.</li>
      </ul>

      <div class="success-box">
        <strong>Final Note:</strong> This report demonstrates a commitment to security best-practices and provides a strong foundation for secure API development and operations.
      </div>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- APPENDIX A -->
    <section id="appendixA" class="page-break" aria-labelledby="appendixA-heading">
      <h1 class="section" id="appendixA-heading">Appendix A — Tools &amp; Test Evidence</h1>

      <h2>Tools Used</h2>
      <ul>
        <li>OWASP ZAP (DAST)</li>
        <li>SonarQube / SpotBugs (SAST)</li>
        <li>Postman / Newman (integration)</li>
        <li>JUnit / Mockito (unit)</li>
        <li>Redis (rate-limiter), H2 (test DB)</li>
      </ul>

      <h3>Selected Test Logs (redacted)</h3>
      <pre><code>--- Integration Test: testAdminAccessForbiddenForNonAdmin
Status: 403
Response: {"status":403,"message":"Forbidden"}
--- END
</code></pre>

      <h3>CI/CD Summary</h3>
      <p>Pipeline: build → unit tests → integration tests → SAST → DAST (staged) → merge gate.</p>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- APPENDIX B -->
    <section id="appendixB" class="page-break" aria-labelledby="appendixB-heading">
      <h1 class="section" id="appendixB-heading">Appendix B — Change Log &amp; Notable Commits</h1>

      <table>
        <thead><tr><th>Date</th><th>Commit</th><th>Notes</th></tr></thead>
        <tbody>
          <tr><td>2025-10-20</td><td>abc123</td><td>Implemented BCrypt hashing and migration flow.</td></tr>
          <tr><td>2025-10-21</td><td>def456</td><td>Added JWT hardening and TTL changes.</td></tr>
          <tr><td>2025-10-22</td><td>ghi789</td><td>Introduced DTOs and fixed excessive data exposure.</td></tr>
        </tbody>
      </table>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <!-- APPENDIX C -->
    <section id="appendixC" class="page-break" aria-labelledby="appendixC-heading">
      <h1 class="section" id="appendixC-heading">Appendix C — Glossary</h1>

      <dl>
        <dt>BCrypt</dt>
        <dd>A secure password hashing algorithm that uses an adaptive work factor.</dd>

        <dt>JWT</dt>
        <dd>JSON Web Token — used for stateless authentication and authorization claims.</dd>

        <dt>RBAC</dt>
        <dd>Role-Based Access Control — authorization model mapping roles to permissions.</dd>
      </dl>

      <a class="back-top" href="#top">Back to Top</a>
    </section>

    <footer>
      <p>Generated on October 26, 2025 at 05:03 PM — OWASP API Vulnerability Lab Team</p>
    </footer>
  </main>

  <script>
    // Print button behavior
    document.getElementById('printBtn').addEventListener('click', function() {
      const originalTitle = document.title;
      document.title = 'OWASP_API_Security_Report';
      window.print();
      setTimeout(() => { document.title = originalTitle; }, 800);
    });

    // Theme toggle: keep preference in localStorage
    const themeBtn = document.getElementById('themeToggle');
    function setTheme(dark) {
      if (dark) {
        document.body.classList.add('dark-theme');
        localStorage.setItem('reportDark', '1');
        themeBtn.textContent = 'Light Mode';
        themeBtn.classList.remove('secondary');
      } else {
        document.body.classList.remove('dark-theme');
        localStorage.removeItem('reportDark');
        themeBtn.textContent = 'Dark Mode';
        themeBtn.classList.add('secondary');
      }
    }

    // Initialize theme
    (function() {
      const pref = localStorage.getItem('reportDark');
      if (pref === '1') {
        setTheme(true);
      } else {
        setTheme(false);
      }
    })();

    themeBtn.addEventListener('click', function() {
      document.body.classList.toggle('dark-theme');
      const isDark = document.body.classList.contains('dark-theme');
      setTheme(isDark);
    });

    // Smooth scroll for internal links
    document.querySelectorAll('a[href^="#"]').forEach(a => {
      a.addEventListener('click', function(e) {
        // allow top/back links to work normally
        const href = this.getAttribute('href');
        if (!href || href === '#') return;
        const target = document.querySelector(href);
        if (target) {
          e.preventDefault();
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          // update history (so print shows correct fragment if needed)
          history.pushState(null, '', href);
        }
      });
    });

    // Accessibility: focus outlines only when keyboard navigating
    (function() {
      let usingKeyboard = false;
      window.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') {
          usingKeyboard = true;
          document.documentElement.classList.add('using-keyboard');
        }
      });
      window.addEventListener('mousedown', function() {
        if (usingKeyboard) {
          usingKeyboard = false;
          document.documentElement.classList.remove('using-keyboard');
        }
      });
    })();

    // NOTE: Page numbers in the TOC are static approximations for print layout.
    // True print page numbers require server-side PDF generation or CSS paged media tooling.
    // The "P2" style requested (space-filled) is implemented visually by layout above.
  </script>
</body>
</html>
